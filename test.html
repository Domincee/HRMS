<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
      <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"  rel="stylesheet"

</head>
<style>
    *{
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        list-style: none;
    }

    body{
        display: flex;
        flex-direction: column;
        gap: 15px;
        background-color: rgb(255, 255, 255);
    }

    header{
        height: 12vh;
    }

    header .head-box{
    position: fixed;
        display: flex;
        top: 0;
        left: 0;
        height: 12vh;
        width: 100%;
        justify-content: space-between;
        align-items: center;
        padding: 0 10px 0 0;
        z-index: 100;
       
    }

    .logo-container{
        align-items: center;
        display: flex;
        flex-direction: column;
        height: 80%;
        width: 60px;
    }

    .logo{
        background-color: #000;
        width: 100%;
        height: 50vh;
        color: #ffff;
        text-align: center;
        align-self: center;
        align-items: center;
        display: flex;
        font-weight: 600;
        font-size: 1.1rem;
        border-radius: 100%;
        justify-content: center;
    }

    .account-container{
        padding: 5px;
        
    }
  
    #toggleDropdown i{
        color: #322f2f;
        border-radius: 15px;
        font-size: 1.8rem;
    }
    
    .accout-dropdown{
        display: flex;
        flex-direction: column;
        position: absolute;
        font-size: 1.8rem;
        gap: 14px;   
        opacity: 0;
        padding: 0 5px 0 5px;
        overflow: hidden;     
        transition: all 0.3s ease-in-out;
        padding-top: 14px;
                
    }
      .account-container li{
        transition: all 0.3s ease-in-out;
        padding: 5px;
        width: 100%;
    }

    .accout-dropdown li img{
        color: #ffff;
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    .account-container li:hover{
        cursor: pointer;
    }
    .dropdown-container{
        transition: all 0.6s ease-in-out;
    }
     .dropdown-container:hover{
        scale: 1.1;
     }
    .dropdown-container:hover .accout-dropdown{
        height: fit-content;
        animation: grow 1s ease-in-out;
        opacity: 1;
        
          background-color: #777a739d;

    }



    .bell-notif{
            position: relative;
    }
    .bell-notif:hover{
        animation: shake 0.5s ease-in-out forwards;
    }
 
    .settings:hover {
         transform-origin: center;
           scale: 1.1;

    }
        
    .mess-notif:hover{
        scale: 1.1;
    }
    .sign-out:hover{
        scale: 1.1;
    }


@keyframes shake {
    0% { transform:  rotate(0); }
    25% { transform:  rotate(-10deg); }
    50% { transform:  rotate(10deg); }
    75% { transform:  rotate(-10deg); }
    100% { transform:  rotate(0); }
}


.bottom-box{
    position: fixed;
    display: flex;
    width: 95%;
    align-self: center;
    justify-content: space-around;
    height: 40px;
    bottom: 15px;
    border: 2px solid #e7dede;
    background-color: rgb(228, 243, 227);
    border-radius: 12px;
    box-shadow: 0 2px 5px #5a5858b4;
    align-items: center;
}
.navigator-container{
    display: flex;
    flex-direction: row;
    width: 70%;
    justify-content: space-between;
}

.navigator-container li{
        z-index: 100;

    font-size: 1.5rem;
    transition: all 0.3s ease-in-out;
}
.navigator-container li:hover{
    scale: 1.2;
    cursor: pointer;
}

.quicManage{
 width: 20%;
 align-items: center;
 display: flex;
 justify-content: center;
}
.quickManage-container{
    display: flex;
    flex-direction: column-reverse;
}

.manage-show{
   display: flex;
    padding-bottom: 40px;
    gap: 10px;
    flex-direction: column-reverse;
    position: absolute;
    opacity: 0;
    overflow: hidden;
    transition: 0.3s ease-in-out;
}
.manage-show li{
   z-index: 100;
   padding: 5px;
   transition: all 0.3s ease-in-out;
  border-radius: 12%;
   align-items: center;
    background-color: #04d859ac;
}

.manage-show li:hover{
    scale: 1.1;
    cursor: pointer;
    background-color: #07ff6afe;
}
.quickManage-container:hover .manage-show{
   opacity: 1;
  animation: grow 1s ease-in-out;
}
.toggle-show{

    transition: all 0.3s ease-in-out;
    padding: 4px;
        z-index: 100;

}
.toggle-show:hover{
    cursor: pointer;
    scale: 1.2;
}



.list-icon.active{
    scale: 1.3;
}
 @keyframes grow {
    from {
        max-height: 0;
    }
    to {
        max-height: 500px; /* Set a reasonable max height */
    }
}



/* DASHBOARD STYLE */
.dashboard-section{
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}


.dashboard-section h1{
    margin-bottom: 12px;
}
.card   {
    display: flex;
    flex-direction: column;
    gap: 5px;
    text-align: center;
    border: 2px solid #000;
    border-radius: 12px;
    word-break: break-all;
    padding: 5px;
    word-wrap: break-word;
    width: 125px;
    
}

.card3 .btns button{
    all: unset;
    font-size: 0.8rem;
    font-weight:600;
    background-color: white;
    box-shadow: 0 1px 4px 1px #1a191971;
    padding: 3px;
    border-radius: 10px;
    width: 40px;
    transition: all 0.3s ease-in-out;
    
    
}

.card3 .btns button:nth-child(1){
    background-color: #1f52b1;
    color: rgb(255, 255, 255);
    box-shadow: 0 1px 4px 1px #5390e082;
}
.card3 .btns button:hover{
    scale: 0.9;
    cursor: pointer;
}

.container-1 { 
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-auto-flow: row;
  grid-template-areas:
    "card card1"
    "card2 card3";
}

.card { grid-area: card; }

.card1 { grid-area: card1; }

.card2 { grid-area: card2; }

.card3 { grid-area: card3; }



/* search and filter styles*/
.top-container{
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 5px;
    padding: 0 5px 0 5px;
    width: 100%;

}
.search-container{
    width: 100%;
    max-width: 150px;
    margin-top: 15px;
}

.searchbar {
    border: 2px solid #0000003b;
    outline: none; /* Remove default browser outline */
    transition: all 0.3s ease-in-out; /* Smooth animation */
    border-radius: 5px;
    width: 100%;
    height: 20px;
}

.searchbar:focus {
    border: 2px solid #000; /* Change border when typing */
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.5); /* Add a glowing effect */
}

#departmentFilter{
    background-color: rgb(255, 254, 253);
    width: 100%;
    height: 20px;
    width: 100%;
    border-radius: 12px;
    padding: 3px;
    font-weight: 600;
    font-size: 0.8rem;
}
.table-container {
  max-height: 150px; /* Adjust height as needed */
  overflow-y: auto;
  border: 2px solid #605d5d;
  margin-top: 20px;
  border-radius: 5px;
}

.tableEmployee tbody td{
    text-align: center;
    padding: 5px;
}

.table-container::-webkit-scrollbar{
    background-color: rgba(106, 25, 25, 0.658);
    width: 6px;
    height: 4px;
}

.table-container::-webkit-scrollbar-thumb {
  background: #1c1111;
  border-radius: 6px;
}

.table-container::-webkit-scrollbar-track {
    background-color: #dcb6b6;
}
.tableEmployee{
    width: 100%;
    font-size: 0.6rem;
    font-weight: 700;
}

/* Chart */
    .chart-container{
        display: flex;
        flex-direction: column;
        text-align: center;
        align-items: center;
        height: 70vh;
        z-index: -1;
    }
    .chart-container h2{
        margin: 15px 0 15px 0;
    }

      .chart {
      display: flex;
      align-items: flex-end;
      gap: 5px;
      height: 35vh;
      border: 2px solid #000;
      padding: 20px;
      width: 100%;
    }

    .bar {
      width: 15px;
      background-color: #4CAF50;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .bar-label {
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      font-size: 12px;
      margin-top: 5px;
    }

    .bar-value {
      position: absolute;
      top: -20px;
      font-size: 12px;
      font-weight: bold;
    }

    .highlight {
      background-color: orange !important;
    }
    .color-per-dep {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
     }

    .dep-color-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.6rem;
        font-weight: 700;
     }

    .dep-color-circle {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 1.5px solid #0000008c;
       }
    </style>
<body>
    <header>
        <div class="head-box">
            <div class="logo-container" id="logoHolder">
        
                <p class="logo">HRMS</p>
            </div>




            <div class="account-container">
                <ul class="dropdown-container" >
                
                    <li class="toggle-drop" id="toggleDropdown">
                        <i class="ri-account-circle-fill"></i>
                    </li>
            
                    <ul class="accout-dropdown">
                    
                        <li class="bell-notif" id="notification" > 
                            <img  src="/public/imgs-icons/notification.png" alt="settings">
                        </li>
                        <li class="mess-notif" id="messages">
                            <img  src="/public/imgs-icons/message.png" alt="messages">
                        </li>
                        <li class="settings" id="settings">
                            <img src="public/imgs-icons/setting.png" alt="settings">    
                        </li>
                        <li class="sign-out" id="singOut">
                            <img src="public/imgs-icons/out.png" alt="settings">    
                        </li>
                    </ul>
                </ul>
            </div>
        </div>
    </header>

    <div class="bottom-box">
        <ul class="navigator-container">

            <li class="list-icon active" id="toggleDashboard"><i class="ri-dashboard-horizontal-line"></i></li>
            <li class="list-icon employee" id="toggleEmployee"><i class="ri-user-fill"></i></li>
            <li class="list-icon attendance" id="toggleAttendance"><i class="ri-calendar-check-line"></i></li>
            <li class="list-icon perforamce" id="togglePerformance"><i class="ri-line-chart-fill"></i></li>
            
        </ul>
        <div class="quicManage">
            <ul class="quickManage-container" >
                
                    <li class="toggle-show" id="toggleShowUp">
                        <img src="/public/imgs-icons/plus.png" alt="Show Manage">
                    </li>
            
                    <ul class="manage-show">
                    
                        <li class="add-new" id="addEmployee" > 
                            <img  src="/public/imgs-icons/people.png" alt="Add Employee">
                        </li>
                        <li class="edit-employee" id="editEmployee">
                            <img  src="/public/imgs-icons/edit.png" alt="messages">
                        </li>
                        <li class="new-message" id="newMessage">
                            <img src="public/imgs-icons/conversation.png" alt="settings">    
                        </li>
                    
                    </ul>
            </ul>
        </div>

     
    </div>


    <section class="dashboard-section" id="dashboard">
        <h1>Dashboard</h1>
        <div class="container-1">
        <div class="card">
            <span id="employee">Employees</span>
                    <div class="count">
                        <strong>Total : </strong>
                        <span id="totalEmployee">0</span>
                        <i class="ri-user-fill"></i> 
                    </div>
        </div>
        <div class="card card1 "> 
               <span id="newEmp">New Employees</span>
                    <div class="count">
                        <strong>Total : </strong>
                        <span id="newEmpTotal">0</span>
                        <i class="ri-user-fill"></i> 
                    </div>
        </div>
        <div class="card card2 ">
            <p>On leave</p>
                <div class="count">
                        <strong>Total : </strong> 
                        <span id="onLeaveTotal">0</span>
                        <i class="ri-user-fill"></i> 
                    </div>
                </div>
         <div class="card card3">
            <p>Manage <br> Employee</p>
                <div class="btns">
                  <button class="add-new" >Add</button>
                  <button class="edit-employee">Edit</button>
            </div>
        </div>
        </div>
    
        </div>

    <div class="top-container">

        
        <div class="search-container">
            <input class="searchbar" type="text" id="searchInput" placeholder="Search">

        </div>
          <div class="filter-container">
              <select id="departmentFilter" >
                <option value="All">All</option>
              </select>
        </div>


    <div class="table-container">
        <table class="tableEmployee">
            <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Age</th>
                <th>Department</th>
                <th>Date Hired</th>
                <th>Active</th>
                
            </tr>
    
            </thead>
            <tbody id="employeeTableBody">
            <!-- Employee rows will be inserted here -->
            </tbody>
        </table>
    </div>

    <div class="chart-container">
        <h2>Employees Per Department</h2>
        <div class="chart" id="chart"></div>

        <div class="color-per-dep" id="departmentColor"></div>
     </div>
    </div>
</body>
    
    <script type="module">
import { saveEmployees, loadEmployees } from '/public/js/storage.js';
import { employeesFromRecord } from '/public/js/record.js';

let employees = loadEmployees() || [...employeesFromRecord];

const tableBody = document.getElementById("employeeTableBody");
const departmentFilter = document.getElementById("departmentFilter");
const chart = document.getElementById("chart");

// Populate department filter
function populateDepartmentFilter() {
  const uniqueDepartments = new Set(employees.map(emp => emp.department.trim()));
  departmentFilter.innerHTML = `<option value="All">All</option>`;
  uniqueDepartments.forEach(dept => {
    const option = document.createElement("option");
    option.value = dept;
    option.textContent = dept;
    departmentFilter.appendChild(option);
  });
}

// Render employee table
function renderTable(data) {
  tableBody.innerHTML = "";
  if (data.length === 0) {
    tableBody.innerHTML = `<tr><td colspan="7" style="text-align:center;">No employees found.</td></tr>`;
    return;
  }
  data.forEach(emp => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><b> ${emp.id} </b></td>
      <td>${emp.firstName}</td>
      <td>${emp.lastName}</td>
      <td>${emp.age}</td>
      <td>${emp.department}</td>
      <td>${emp.dateHired}</td>
      <td>${emp.active ? "Yes" : "No"}</td>
    `;
    tableBody.appendChild(row);
  });
}

// Render chart with sorted and filtered data

function renderChart(data) {
  chart.innerHTML = "";
  const departmentCounts = {};

  data.forEach(emp => {
    const dept = emp.department.trim();
    departmentCounts[dept] = (departmentCounts[dept] || 0) + 1;
  });

  const sortedDepartments = Object.entries(departmentCounts).sort((a, b) => a[1] - b[1]);
  const maxCount = Math.max(...Object.values(departmentCounts));

  sortedDepartments.forEach(([dept, count]) => {
    const bar = document.createElement("div");
    bar.className = "bar";
    bar.style.backgroundColor = getColorForDepartment(dept);
    bar.style.height = `${(count / maxCount) * 50}%`;
    if (count === maxCount) bar.classList.add("highlight");

    const value = document.createElement("div");
    value.className = "bar-value";
    value.textContent = count;
    bar.appendChild(value);

    const label = document.createElement("div");
    label.className = "bar-label";
    bar.appendChild(label);

    chart.appendChild(bar);
  });
}

function renderDepartmentColors() {
  const container = document.getElementById("departmentColor");  // make sure this id matches your HTML
  container.innerHTML = "";

  Object.entries(departmentColorMap).forEach(([dept, color]) => {
    const item = document.createElement("div");
    item.className = "dep-color-item";

    const circle = document.createElement("div");
    circle.className = "dep-color-circle";
    circle.style.backgroundColor = color;

    const label = document.createElement("span");
    label.textContent = dept;

    item.appendChild(circle);
    item.appendChild(label);
    container.appendChild(item);
  });
}


/* Color assign bar chart */
const departmentColorMap = {};
const colorPalette = [
  "#4CAF50", "#2196F3", "#FFC107", "#E91E63", "#9C27B0", 
  "#FF5722", "#607D8B", "#3F51B5", "#009688", "#795548", "#07ff6afe"
];

function getColorForDepartment(dept) {
  if (!departmentColorMap[dept]) {
    const usedColors = Object.values(departmentColorMap);
    const availableColors = colorPalette.filter(c => !usedColors.includes(c));
    departmentColorMap[dept] = availableColors.length > 0
      ? availableColors[Math.floor(Math.random() * availableColors.length)]
      : `#${Math.floor(Math.random()*16777215).toString(16)}`; // fallback random hex color
  }
  return departmentColorMap[dept];
}













// Department dropdown change event
departmentFilter.addEventListener("change", () => {
  const selected = departmentFilter.value;
  const filtered = selected === "All"
    ? employees
    : employees.filter(emp => emp.department.trim() === selected);
  renderTable(filtered);
  renderChart(filtered);
});

// For live updates
function addEmployee(employee) {
  employees.push(employee);
  populateDepartmentFilter();
  const selected = departmentFilter.value;
  const filtered = selected === "All"
    ? employees
    : employees.filter(emp => emp.department.trim() === selected);
  renderTable(filtered);
  renderChart(filtered);
}


const searchInput = document.getElementById("searchInput");

searchInput.addEventListener("input", () => {
  const query = searchInput.value.trim().toLowerCase();

  const filtered = employees.filter(emp => 
    emp.firstName.toLowerCase().startsWith(query) ||
    emp.lastName.toLowerCase().startsWith(query) ||
    emp.department.toLowerCase().startsWith(query)
  );

  renderTable(filtered);
  renderBarGraph(filtered);  // Update the bar chart based on filtered results
});


// Initial render

populateDepartmentFilter();
renderTable(employees);
renderChart(employees);
renderDepartmentColors();
</script>
</html>